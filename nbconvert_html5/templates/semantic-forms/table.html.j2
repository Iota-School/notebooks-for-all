{#
this notebook template represents cells as a feed pattern of complex forms.
it is designed with aria in mind, all possible aria is included. the resting, or static, state
of the notebook is represented here. features are progressively added by flipping different aria switches.

we make no distinction between markdown and code cells. in fact, they are synthesized by adds draggable, multiselectable
tabs
in the input area.

for optimal aria support, we wrap input cells in a figure tag so that the figcaption can become the aria-describedby
reference.

#}
{%- extends 'semantic-forms/base.html.j2' -%}

{%- block header -%}
<html lang="en">

<head>
    <title></title>
    <meta name="color-scheme" content="dark light">
    <style>
        {% include "semantic-forms/static/style.css" %}
    </style>
</head>
{%- endblock header -%}


{%- block body -%}

<body>
    <nav class="skip" aria-label="skip links">
        <a class="skip sro" tabindex="0" href="#cells">Skip to Content</a>
        <a class="skip sro" tabindex="0" href="#toc" onclick="document.getElementById('toc').open = true">Skip to Table
            of Contents</a>
    </nav>
    <header id="header">
        <!-- use headers for introductory content -->
        <nav id="site" aria-label="site-navigation"></nav>
    </header>
    <main class="notebook static" aria-labelledby="notebook-caption">
        <!--the notebook is main area. it is represented by a big table. -->
        <header>
            <!--this is generated from the dom. sure these is a resting state, but this should probably in the javascript so its updates when interactive.-->
            <span id="notebook-caption">{{resources.metadata.path}}/{{resources.metadata.name}}.ipynb
                <button onclick="document.querySelector('#nb-metadata').showModal()" title="show notebook metadata" {%
                    if not nb.metadata %}disabled{% endif %}>ðŸ›ˆ</button>
            </span>
            <dialog class="metadata" id="nb-metadata">
                <figure>
                    {{markdown("```json\n" + json.dumps(nb.metadata, indent=2) + "\n```\n")}}
                    <figcaption>notebook metadata</figcaption>
                </figure>
                <form method="dialog">
                    <button>OK</button>
                </form>
            </dialog>
        </header>
        <!-- metadata is NOT introductory content, and it is supplemental, it is NOT complementary -->
        <!-- metadata is colorless at rest so we place it in a dialog that can be revealed by the user -->
        <table class="cells" id="cells" aria-labelledby="notebook-caption">
            <thead>
                <tr class="cell header">
                    {# <th class="index" scope="col">index</th> #}
                    {# we dont need to keep the index because the table manages that for us. #}
                    <th class="execution_count" scope="col">execution count</th>
                    <th class="cell_type" scope="col">cell type</th>
                    <th class="source" scope="col">source</th>
                    <th class="outputs" scope="col">outputs</th>
                    <th class="metadata" scope="col">metadata</th>
                </tr>
            </thead>
            <tbody>
                {% for i, cell in enumerate(nb.cells) %}
                {{cell_form(cell_type=cell.cell_type, source=cell.source, id=cell.id, metadata=cell.metadata,
                outputs=cell.outputs,
                execution_count=cell.execution_count, count=i, total_count=len(cells), cell=cell)}}
                {% endfor %}
            </tbody>
            <tfoot>
                <tr></tr>
            </tfoot>

        </table>
        <footer id="nb-footer">
            <nav class="notebook" aria-label="table">  
              <details id="toc">
                    <summary id="toc-summary"><span aria-hidden="true">ðŸ“‘</span> Table of Contents</summary>
                </details>
            </nav>
        </footer>
    </main>
    <footer id="footer">
        <details id="accessibility-settings">
            <summary><span aria-hidden="true">âš™</span> Accessibility Settings</summary>
            <form id="accessibility-settings">
            work in progress
            </form>
        </details>
        <a href="#cells">Scroll to Top</a>
    </footer>
</body>
{%- endblock body -%}

{%- block footer -%}

</html>
{%- endblock footer -%}


{% macro highlight(body, type) %}
{{body}}
{% endmacro %}

{% macro metadata_dialog(metadata) %}
{% endmacro %}

{% macro cell_form(cell_type, count=0, total_count=1, id="", execution_count="", source="", outputs="", metadata=None,
cell=cell)
%}
{% set metadata = metadata or {} %}
{% set count = count + 1 %}
{% set source = "".join(source) %}
{% set FORM = "cell-" + str(id or count) %}

<tr class="cell {{cell_type}}" id="cell-{{count}}" draggable="false" aria-busy="false">
    <td class="execution_count" id="{{FORM}}-exec">{{execution_count}}</td>
    <td class="cell_type">
        <label class="cell_type">
            <select name="cell_type" disabled>
                <option {% if cell_type=="code" %}selected{% endif %} value="code">code</option>
                <option {% if cell_type=="markdown" %}selected{% endif %} value="markdown">markdown</option>
                <option {% if cell_type=="raw" %}selected{% endif %} value="raw">raw</option>
                <option {% if cell_type=="unknown" %}selected{% endif %} value="unknown">unknown</option>
            </select> cell
        </label>
    </td>
    <td class="source">
        <form id="{{FORM}}" aria-label="{{cell_type}} cell {{count}}">
            <textarea readonly class="sro" name="source" id="{{FORM}}-source" aria-hidden="false" autocomplete="off"
                autocorrect="off" placeholder="" spellcheck="default" rows="{{len(source.rstrip().splitlines())}}"
                aria-labelledby="{{FORM}}-exec" wrap="soft">{{source}}</textarea>
            <div class="render" aria-hidden="{% if cell_type == "markdown" %}false{% else %}true{% endif %}">
                {% if cell_type=="markdown" %}{{markdown(source)}}{% endif %}
                {% if cell_type=="code" %}{{markdown("```IPython3\n"+"".join(source)+"\n```\n")}}{% endif %}
            </div>
            <input type="submit" for="{{FORM}}-source" value="run" title="run the cell" class="sro" tabindex="0">
        </form>
    </td>
    <td class="outputs">
        {% for i, output in enumerate(outputs) %}
        {% block output scoped %}{% block output_prompt %}{% endblock %}{{super()}}{% endblock %}
        {% endfor %}
    </td>
    <td class="metadata">
        <button onclick="document.querySelector('#{{FORM}}-metadata').showModal()" title="show metadata" {% if not
            metadata %}disabled{% endif %}>ðŸ›ˆ</button>
        <dialog class="metadata" id="{{FORM}}-metadata">
            <figure>
                {{markdown("```json\n" + json.dumps(metadata, indent=2) + "\n```\n")}}
                <figcaption id="{{FORM}}-metadata-caption">{{cell_type}} metadata</figcaption>
            </figure>
            <form method="dialog">
                <button>OK</button>
            </form>
        </dialog>
    </td>

</tr>
{% endmacro %}

{#
<footer>
    <label class="start_time">
        <output><time></time></output>
    </label>
    <label class="end_time">
        <output><time></time></output>
    </label>
    <label class="elapsed_time">
        <output><time></time></output>
    </label>
</footer> #}