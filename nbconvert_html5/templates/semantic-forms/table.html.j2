{%- extends 'semantic-forms/base.html.j2' -%}
{% from 'mathjax.html.j2' import mathjax %}
{% from 'jupyter_widgets.html.j2' import jupyter_widgets %}

{%- block header -%}
<!DOCTYPE html>
<html lang="en">

<head>
    {%- block html_head -%}
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% set nb_title = nb.metadata.get('title', resources['metadata']['name']) | escape_html %}
    <title>{{nb_title}}</title>
    <meta name="color-scheme" content="dark light">
    <meta name="description" content="">


    {% block jupyter_widgets %}
    {%- if "widgets" in nb.metadata -%}
    <script src="{{ resources.require_js_url }}"></script>
    {{ jupyter_widgets(resources.jupyter_widgets_base_url, resources.html_manager_semver_range,
    resources.widget_renderer_url) }}
    {%- endif -%}
    {% endblock jupyter_widgets %}

    {% block extra_css %}
    {% endblock extra_css %}

    {% for css in resources.inlining.css -%}
    <style type="text/css">{{css}}</style>
    {% endfor %}

    {% block notebook_css %}
    {{ resources.include_css("semantic-forms/static/style.css") }}
    {% endblock notebook_css %}
    
    {%- block html_head_js_mathjax -%}
    {{ mathjax(resources.mathjax_url) }}
    {%- endblock html_head_js_mathjax -%}

    {%- endblock html_head -%}
</head>
{%- endblock header -%}




{%- block body_header -%}

<body>
    <header class="site">
        <a class="visually-hidden" tabindex="0" href="#/cells">Skip to Main Content</a>
        <a class="visually-hidden" tabindex="0" href="#site-settings-summary">Skip to Accessibility Settings</a>
        <!-- search and site navigation would go here -->
        <!-- links go to the original content -->
    </header>
    <main class="notebook static" aria-label="notebook" id="nb-main">
        <header class="notebook" id="nb-header">
            <details id="nb-nav" class="nav">
                <summary id="nb-nav-summary"><span id="nb-nav-summary-name">{{resources.metadata.name}}.ipynb</span>
                    Navigation</summary>
                <form id="nb-nav-cells">
                    <label for="nb-nav-cells-widget">Navigate to Cell</label>
                    <input type="range" id="nb-nav-cells-widget" value="1" min="1" max="{{len(nb.cells)+1}}">
                    <output></output>
                </form>
                <nav></nav>
            </details>
        </header>
        <table class="notebook cells" aria-label="cells" aria-rowcount="{{len(nb.cells)}}">
            <colgroup>
                <col class="execution_count">
                <col class="source">
                <col class="outputs">
                <col class="cell_type">
                <col class="metadata">
                <col class="toolbar">
            </colgroup>
            <thead>
                <tr class="cell">
                    <th scope="col">execution count</th>
                    <th scope="col">source</th>
                    <th scope="col">outputs</th>
                    <th scope="col">cell type</th>
                    <th scope="col">metadata</th>
                    <th scope="col">toolbar</th>
                </tr>
            </thead>
            <tbody id="/cells">
                {%- endblock body_header -%}
                {% block body_loop %}
                {% for cell in nb.cells %}
                {% block anycell scoped %}
                {{cell_row(cell, nb, resources)}}
                {% endblock anycell %}
                {% endfor %}
                {% endblock body_loop %}
                {%- block body_footer -%}
            </tbody>
            <tfoot>
                <td class="execution count"></td>
                <td class="source"></td>
                <td class="outputs"></td>
                <td class="cell type"></td>
                <td class="metadata"></td>
                <td class="toolbar"></td>
            </tfoot>
        </table>
        <footer id="nb-footer" class="notebook">
            <details id="nb-metadata">
                <summary>metadata</summary>
                <script id="/metadata" type="application/json">{{json.dumps(nb.metadata, indent=2)}}</script>
            </details>
        </footer>
    </main>
    <footer id="site-footer">
        <!-- legal goes here -->
        <details id="site-settings">
            <summary id="site-settings-summary">Site Accessibility Settings</summary>
        </details>
    </footer>
</body>
{%- endblock body_footer -%}

{% block footer %}
{% block footer_js %}
{{resources.include_js("semantic-forms/static/script.js")}}
{% endblock footer_js %}
{{ super() }}

</html>
{% endblock footer %}

{% macro highlight(body, type) %}
{{markdown("```{{type}}\n" + json.dumps(nb.metadata, indent=2) + "\n```\n")}}
{% endmacro %}


{% macro cell_row(cell, nb, resources={}) %}
{% set count = nb.cells.index(cell) %}
{% set ID = "cell-" + str(cell.id or count) %}
<tr class="cell {{cell.cell_type}} {{celltags(cell)}}" id="/cells/{{count}}" draggable="false" aria-busy="false"
    aria-rowindex="{{nb.cells.index(cell)+1}}">
    <td class="execution_count" {{hide(cell.execution_count)}}><label for="{{ID}}-source"
            id="{{ID}}-exec">{{cell.execution_count or ""}}</label></td>
    <td class="source" {{hide(resources.global_content_filter.include_input)}}>
        {{source_cell(cell, nb, ID)}}</td>
    <td class="outputs">
        {{outputs_cell(cell, ID)}}</td>
    <td class="cell_type">{{cell_type_cell(cell)}}</td>
    <td class="metadata">
        <script id="/cells/{{count}}/metadata"
            type="application/json">{{json.dumps(cell.metadata, indent=2) | escape_html}}</script>
    </td>
    <td class="toolbar">{{cell_toolbar(cell, ID)}}</td>
</tr>
{% endmacro %}


{% macro cell_type_cell(cell) %}
{% set cell_type = cell.cell_type %}
<label class="cell_type">
    <select name="cell_type" disabled>
        <option {% if cell_type=="code" %}selected{% endif %} value="code">code</option>
        <option {% if cell_type=="markdown" %}selected{% endif %} value="markdown">markdown</option>
        <option {% if cell_type=="raw" %}selected{% endif %} value="raw">raw</option>
        <option {% if cell_type=="unknown" %}selected{% endif %} value="unknown">unknown</option>
    </select>
</label>
{% endmacro %}

{% macro source_cell(cell, nb, ID) %}
{% set count = nb["cells"].index(cell) +1%}
{% set source = cell.source %}
<form id="{{ID}}" aria-label="{{cell.cell_type}} cell {{count}}">
    <textarea readonly class="visually-hidden" name="source" id="{{ID}}-source" aria-hidden="false" autocomplete="off"
        autocorrect="off" placeholder="" spellcheck="default" rows="{{len(source.rstrip().splitlines())}}"
        aria-labelledby="{{ID}}-exec" wrap="soft">{{source}}</textarea>
    <div class="render" role="document" aria-hidden="{% if cell.cell_type == "markdown" %}false{% else %}true{% endif
        %}">
        {% if cell.cell_type=="markdown" %}{{markdown(cell.source) | strip_files_prefix}}{% endif %}
        {% if cell.cell_type=="code" %}{{ cell.source | highlight_code(metadata=cell.metadata) }}{% endif %}
    </div>
</form>
{% endmacro %}

{% macro outputs_cell(cell, ID) %}
{% for i, output in enumerate(cell.outputs) %}
{% block output scoped %}{% block output_prompt %}{% endblock %}{{super()}}{% endblock %}
{% endfor %}
{% endmacro %}


{% macro cell_toolbar(cell, ID) %}
<div role="toolbar">
    <input class="run" type="submit" form="{{ID}}" for="{{ID}}-source" value="run" title="run the cell"
        tabindex="0">
    <button onclick="document.querySelector('#{{ID}}-metadata').showModal()" title="show metadata">ðŸ›ˆ</button>
</div>
{% endmacro %}

{% macro hide(x) %}{% if not x %}hidden{% endif %}{% endmacro %}